import{s as $,y as ee,e as _,k as G,c as v,a as b,d as u,o as K,f as i,i as H,g as f,C as Q,u as q,A as fe,j as N,p as pe,q as me,t as te,b as le,h as se,n as he}from"../chunks/scheduler.CRl-z1y4.js";import{S as ae,i as oe,f as _e,b as re,d as ne,m as ce,t as ie,a as ue,e as de}from"../chunks/index.Ci9MLlfz.js";import"../chunks/Toaster.svelte_svelte_type_style_lang.CQ9dEDgo.js";import{g as ve}from"../chunks/entry.CKIhGktT.js";import{c as be,a as ge,u as xe,m as we,e as ke}from"../chunks/index.iZ7GkiWf.js";import{c as Ee}from"../chunks/index.C1J9xu5V.js";import{s as ye}from"../chunks/index.DD5gL1tX.js";import{S as De}from"../chunks/Selector.BIS03Tn0.js";function Ie(s){let e,t=s[5].t("Cancel")+"",l,r,d;return{c(){e=_("button"),l=te(t),this.h()},l(a){e=v(a,"BUTTON",{class:!0});var c=b(e);l=le(c,t),c.forEach(u),this.h()},h(){i(e,"class","px-3 py-1.5 text-sm font-medium bg-gray-300 text-black transition rounded-full")},m(a,c){H(a,e,c),f(e,l),r||(d=q(e,"click",s[13]),r=!0)},p(a,c){c&32&&t!==(t=a[5].t("Cancel")+"")&&se(l,t)},d(a){a&&u(e),r=!1,d()}}}function Se(s){let e,t=s[5].t("Run")+"",l,r,d;return{c(){e=_("button"),l=te(t),this.h()},l(a){e=v(a,"BUTTON",{class:!0});var c=b(e);l=le(c,t),c.forEach(u),this.h()},h(){i(e,"class","px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full")},m(a,c){H(a,e,c),f(e,l),r||(d=q(e,"click",s[12]),r=!0)},p(a,c){c&32&&t!==(t=a[5].t("Run")+"")&&se(l,t)},d(a){a&&u(e),r=!1,d()}}}function Ve(s){let e,t,l,r,d,a,c,D,p,x,V,w,k,S,m,C,R,I,T,B,O;function M(n){s[9](n)}let o={placeholder:s[5].t("Select a model"),items:s[4].map(Z)};s[1]!==void 0&&(o.value=s[1]),p=new De({props:o}),ee.push(()=>_e(p,"value",M));function j(n,g){return n[2]?Ie:Se}let A=j(s),h=A(s);return{c(){e=_("div"),t=_("div"),l=_("div"),r=_("div"),d=_("div"),a=_("div"),c=_("div"),D=_("div"),re(p.$$.fragment),V=G(),w=_("div"),k=_("div"),S=_("div"),m=_("textarea"),R=G(),I=_("div"),h.c(),this.h()},l(n){e=v(n,"DIV",{class:!0});var g=b(e);t=v(g,"DIV",{class:!0});var E=b(t);l=v(E,"DIV",{class:!0});var y=b(l);r=v(y,"DIV",{class:!0});var U=b(r);d=v(U,"DIV",{class:!0});var Y=b(d);a=v(Y,"DIV",{class:!0});var z=b(a);c=v(z,"DIV",{class:!0});var F=b(c);D=v(F,"DIV",{class:!0});var J=b(D);ne(p.$$.fragment,J),J.forEach(u),F.forEach(u),z.forEach(u),Y.forEach(u),U.forEach(u),V=K(y),w=v(y,"DIV",{class:!0,id:!0});var L=b(w);k=v(L,"DIV",{class:!0});var P=b(k);S=v(P,"DIV",{class:!0});var W=b(S);m=v(W,"TEXTAREA",{id:!0,class:!0,placeholder:!0}),b(m).forEach(u),W.forEach(u),P.forEach(u),L.forEach(u),R=K(y),I=v(y,"DIV",{class:!0});var X=b(I);h.l(X),X.forEach(u),y.forEach(u),E.forEach(u),g.forEach(u),this.h()},h(){i(D,"class","max-w-full"),i(c,"class","overflow-hidden w-full"),i(a,"class","flex w-full"),i(d,"class","flex flex-col gap-1 w-full"),i(r,"class","flex flex-col justify-between mb-1 gap-1"),i(m,"id","text-completion-textarea"),i(m,"class","w-full h-full p-3 bg-transparent border border-gray-50 dark:border-gray-850 outline-none resize-none rounded-lg text-sm"),i(m,"placeholder",C=s[5].t("You're a helpful assistant.")),i(S,"class","flex-1"),i(k,"class","h-full w-full flex flex-col"),i(w,"class","pt-0.5 pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0"),i(w,"id","messages-container"),i(I,"class","pb-3 flex justify-end"),i(l,"class","flex flex-col h-full px-4"),i(t,"class","mx-auto w-full md:px-0 h-full"),i(e,"class","flex flex-col justify-between w-full overflow-y-auto h-full")},m(n,g){H(n,e,g),f(e,t),f(t,l),f(l,r),f(r,d),f(d,a),f(a,c),f(c,D),ce(p,D,null),f(l,V),f(l,w),f(w,k),f(k,S),f(S,m),s[10](m),Q(m,s[0]),f(l,R),f(l,I),h.m(I,null),T=!0,B||(O=q(m,"input",s[11]),B=!0)},p(n,[g]){const E={};g&32&&(E.placeholder=n[5].t("Select a model")),g&16&&(E.items=n[4].map(Z)),!x&&g&2&&(x=!0,E.value=n[1],fe(()=>x=!1)),p.$set(E),(!T||g&32&&C!==(C=n[5].t("You're a helpful assistant.")))&&i(m,"placeholder",C),g&1&&Q(m,n[0]),A===(A=j(n))&&h?h.p(n,g):(h.d(1),h=A(n),h&&(h.c(),h.m(I,null)))},i(n){T||(ie(p.$$.fragment,n),T=!0)},o(n){ue(p.$$.fragment,n),T=!1},d(n){n&&u(e),de(p),s[10](null),h.d(),B=!1,O()}}}const Z=s=>({value:s.id,label:s.name,model:s});function Te(s,e,t){let l,r,d,a,c;N(s,be,o=>t(16,l=o)),N(s,ge,o=>t(17,r=o)),N(s,xe,o=>t(18,d=o)),N(s,we,o=>t(4,a=o));const D=pe("i18n");N(s,D,o=>t(5,c=o));let p="",x="",V=!1,w=!1,k;const S=()=>{const o=k;o&&(o.scrollTop=o==null?void 0:o.scrollHeight)},m=()=>{w=!0,console.log("stopResponse")},C=async()=>{const o=a.find(h=>h.id===x),[j,A]=await Ee(localStorage.token,{model:o.id,stream:!0,messages:[{role:"assistant",content:p}]},`${ke}/api`);if(j&&j.ok){const h=j.body.pipeThrough(new TextDecoderStream).pipeThrough(ye(`
`)).getReader();for(;;){const{value:n,done:g}=await h.read();if(g||w){w&&A.abort("User: Stop Response");break}try{let E=n.split(`
`);for(const y of E)if(y!=="")if(y.includes("[DONE]"))console.log("done");else{let U=JSON.parse(y.replace(/^data: /,""));console.log(U),t(0,p+=U.choices[0].delta.content??"")}}catch(E){console.log(E)}S()}}},R=async()=>{x&&(t(2,V=!0),await C(),t(2,V=!1),w=!1)};me(async()=>{(d==null?void 0:d.role)!=="admin"&&await ve("/"),r!=null&&r.models?t(1,x=r==null?void 0:r.models[0]):l!=null&&l.default_models?t(1,x=l==null?void 0:l.default_models.split(",")[0]):t(1,x="")});function I(o){x=o,t(1,x)}function T(o){ee[o?"unshift":"push"](()=>{k=o,t(3,k)})}function B(){p=this.value,t(0,p)}return[p,x,V,k,a,c,D,m,R,I,T,B,()=>{R()},()=>{m()}]}class Ce extends ae{constructor(e){super(),oe(this,e,Te,Ve,$,{})}}function Re(s){let e,t;return e=new Ce({}),{c(){re(e.$$.fragment)},l(l){ne(e.$$.fragment,l)},m(l,r){ce(e,l,r),t=!0},p:he,i(l){t||(ie(e.$$.fragment,l),t=!0)},o(l){ue(e.$$.fragment,l),t=!1},d(l){de(e,l)}}}class Me extends ae{constructor(e){super(),oe(this,e,null,Re,$,{})}}export{Me as component};
//# sourceMappingURL=19.C6-gEDoE.js.map
